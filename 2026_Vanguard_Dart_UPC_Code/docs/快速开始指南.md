# 上位机助手 v3.1 快速开始指南

## 🚀 5分钟上手指南

### 第一步：安装依赖

```bash
cd /home/bale/QT/LinuxUPC

# 如果使用 Conda
conda activate uart_host
pip install -r requirements.txt

# 如果使用系统 Python
pip3 install -r requirements.txt
```

### 第二步：运行测试脚本

```bash
./test_features.sh
```

测试脚本会自动检查：
- ✓ Python 依赖是否安装
- ✓ 代码语法是否正确
- ✓ 串口权限是否配置
- ✓ 可用串口设备

### 第三步：启动程序

```bash
cd SourceCode
python3 main_app.py
```

---

## 🎯 新功能体验指南

### 1. 串口自动扫描 (30秒)

**操作步骤**:
1. 启动程序后，观察"串口端口"下拉框
2. 应该能看到系统中所有可用的串口设备
3. 点击🔄刷新按钮，列表会重新扫描

**预期效果**:
```
/dev/ttyUSB0 - USB-Serial Controller
/dev/ttyACM0 - Arduino Uno
/dev/ttyTHS1 - Tegra UART
```

**快捷操作**:
- 点击"USB0"按钮 → 自动填入 `/dev/ttyUSB0`
- 点击"THS1"按钮 → 自动填入 `/dev/ttyTHS1`
- 点击"ACM0"按钮 → 自动填入 `/dev/ttyACM0`

---

### 2. 智能日志系统 (30秒)

**操作步骤**:
1. 连接串口设备
2. 观察日志窗口的变化

**预期效果**:
- 每条日志前有时间戳：`[14:23:15]`
- 不同类型的消息有不同颜色：
  - 成功消息显示为绿色
  - 错误消息显示为红色
  - 发送命令显示为黄色
  - 绘图数据显示为蓝色

**示例**:
```
[14:23:15] 已扫描到 3 个串口设备 (灰色)
[14:23:20] [UART] 连接成功 - /dev/ttyUSB0 @ 115200 (绿色)
[14:23:25] 发送: PID,1.0,0.1,0.01 (黄色)
[14:23:30] AT+DRAW+Temperature+25.5 (蓝色)
```

---

### 3. 实时状态栏 (1分钟)

**操作步骤**:
1. 连接串口
2. 发送一些绘图数据
3. 观察窗口底部的状态栏

**预期效果**:

左侧（连接状态）:
```
未连接              → 连接前
已连接: /dev/ttyUSB0 @ 115200  → 连接后
```

右侧（统计信息）:
```
接收: 0 | 绘图点: 0 | 通道: 0     → 初始状态
接收: 15 | 绘图点: 45 | 通道: 3   → 接收数据后
```

**更新频率**: 每秒自动更新

---

### 4. 波形显示控制 (2分钟)

#### 4.1 暂停/继续绘图

**操作步骤**:
1. 切换到"波形显示"标签页
2. 等待波形开始显示
3. 点击"⏸ 暂停绘图"按钮
4. 观察：波形停止更新，但数据仍在接收（状态栏数字继续增加）
5. 点击"▶ 继续绘图"按钮
6. 波形恢复更新

**使用场景**:
- 想仔细查看某段波形细节
- 数据更新太快，想暂停观察
- 截图或演示时冻结画面

#### 4.2 自动缩放

**操作步骤**:
1. 手动拖动或缩放波形图
2. 点击"📐 自动缩放"按钮
3. 视图自动调整以显示所有数据

**使用场景**:
- 数据范围变化大，手动调整麻烦
- 想快速查看全局数据

#### 4.3 清空波形

**操作步骤**:
1. 点击"🗑 清空波形"按钮
2. 所有曲线和数据被清除
3. 可以重新开始绘图

#### 4.4 导出数据

**操作步骤**:
1. 点击"💾 导出数据"按钮
2. 选择保存位置
3. 数据保存为CSV格式

**导出格式**:
```csv
Sample_Index,Current,Temperature,Voltage
0,0.5,25.1,3.3
1,0.6,25.3,3.29
2,0.7,25.5,3.31
```

---

### 5. 配置持久化 (30秒)

**操作步骤**:
1. 首次启动程序
2. 选择串口：`/dev/ttyUSB0`
3. 选择波特率：`115200`
4. 连接成功
5. 关闭程序
6. 重新启动程序

**预期效果**:
- 串口自动填充为 `/dev/ttyUSB0`
- 波特率自动填充为 `115200`

**配置文件位置**:
```
~/.config/uart_host/config.json
```

---

## 🧪 完整测试流程

### 测试环境准备

#### 方案A: 使用虚拟串口（推荐）

```bash
# 1. 安装 socat
sudo apt install socat

# 2. 创建虚拟串口对
socat -d -d pty,raw,echo=0 pty,raw,echo=0

# 输出示例：
# 2025/11/18 14:23:15 socat[12345] N PTY is /dev/pts/3
# 2025/11/18 14:23:15 socat[12345] N PTY is /dev/pts/4

# 3. 记住这两个串口设备名
```

#### 方案B: 使用真实硬件

连接 Arduino、STM32 或其他串口设备

---

### 完整测试步骤

#### 1. 启动主程序

```bash
cd SourceCode
python3 main_app.py
```

#### 2. 测试串口扫描

- ✓ 检查下拉框是否显示可用串口
- ✓ 点击🔄按钮，确认列表刷新
- ✓ 点击快捷按钮，确认自动填充

#### 3. 连接设备

- ✓ 选择串口（如 `/dev/pts/3`）
- ✓ 选择波特率 `115200`
- ✓ 点击"连接"
- ✓ 检查状态栏显示"已连接"
- ✓ 检查日志显示连接成功（绿色）

#### 4. 发送测试数据

在新终端运行：

```bash
# 使用测试脚本（推荐）
python tests/test_plot_simulator.py /dev/pts/4

# 或手动发送
echo "AT+DRAW+Temperature+25.5" > /dev/pts/4
echo "AT+DRAW+Voltage+3.3" > /dev/pts/4
echo "AT+DRAW+Current+1.2" > /dev/pts/4
```

#### 5. 验证波形显示

- ✓ 切换到"波形显示"标签
- ✓ 确认看到多条曲线
- ✓ 确认不同颜色区分
- ✓ 确认图例显示

#### 6. 测试波形控制

- ✓ 点击"暂停"，确认波形停止
- ✓ 点击"继续"，确认波形恢复
- ✓ 点击"自动缩放"，确认视图调整
- ✓ 点击"清空"，确认数据清除

#### 7. 测试数据导出

- ✓ 点击"导出数据"
- ✓ 选择保存位置
- ✓ 打开CSV文件验证格式

#### 8. 测试配置保存

- ✓ 关闭程序
- ✓ 重新启动
- ✓ 确认配置已恢复

---

## 💡 使用技巧

### 技巧1: 快速重连

配置保存功能让重连变得超简单：
1. 启动程序
2. 直接点击"连接"（无需重新选择设置）

### 技巧2: 暂停查看细节

当数据更新很快时：
1. 点击"暂停"
2. 使用鼠标拖动和缩放查看细节
3. 查看完毕后点击"继续"

### 技巧3: 清理旧数据

开始新的测试前：
1. 点击"清空波形"
2. 所有旧数据被清除
3. 统计数字重置

### 技巧4: 多次导出

可以在不同时间点多次导出：
1. 收集一段数据后导出为`test1.csv`
2. 继续收集
3. 再次导出为`test2.csv`

---

## 🐛 常见问题

### Q1: 启动后看不到串口列表

**原因**: 可能没有可用串口或权限问题

**解决**:
1. 检查USB设备是否连接
2. 运行权限检查：`groups | grep dialout`
3. 如果不在dialout组：`sudo usermod -a -G dialout $USER`
4. 重新登录系统

### Q2: 状态栏不更新

**原因**: 这是不太可能的，定时器应该每秒更新

**解决**:
1. 检查是否有错误日志
2. 重启程序

### Q3: 波形不显示

**原因**: 数据格式可能不正确

**检查**:
1. 数据格式必须是：`AT+DRAW+<名称>+<数值>`
2. 使用`+`分隔，不是逗号
3. 数值必须是有效数字

**示例**:
```
✓ AT+DRAW+Temperature+25.5
✗ DRAW,Temperature,25.5  (缺少AT+)
✗ AT+DRAW+Temperature+abc (数值无效)
```

### Q4: 配置文件在哪里？

**位置**: `~/.config/uart_host/config.json`

**查看**:
```bash
cat ~/.config/uart_host/config.json
```

**删除**（重置配置）:
```bash
rm ~/.config/uart_host/config.json
```

---

## 📚 更多信息

- 详细绘图功能说明：`docs/绘图功能说明.md`
- 优化总结：`docs/v3.1优化总结.md`
- 完整README：`README.md`

---

## 🎉 开始使用吧！

现在你已经了解了所有v3.1的新功能，赶快试试吧！

```bash
./test_features.sh
```

祝使用愉快！🚀
